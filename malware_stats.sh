set -x
# create working dir
mkdir malware_samples
cd malware_samples

# clone repositories
git clone git@github.com:ashishb/android-malware.git ashishb_samples
git clone git@github.com:sk3ptre/AndroidMalware_2020.git sk3ptre_samples_2020
git clone git@github.com:sk3ptre/AndroidMalware_2019.git sk3ptre_samples_2019
git clone git@github.com:sk3ptre/AndroidMalware_2018.git sk3ptre_samples_2018

# unzip all zipped files using infected as password
find . -name "*.zip" -exec unzip -o -P infected -d unzipped/ {} \; 2> /dev/null

mkdir all_samples 2> /dev/null


find . -name "*.apk" -exec cp {} all_samples \;
find . -type f -name "*.zip" -exec rm {} \;

for file in $(find . -type f); do
   command_output=$(file "$file")
   if file "$file" | grep -P "(Zip archive|Java archive)"; then
       cp "$file" all_samples
   fi
done

cd ..

python3 -m venv malware_stats_venv
source malware_stats_venv/bin/activate

pip3 install -r requirements.txt
python3 malware_stats.py -d malware_samples/all_samples

# exit venv
deactivate

# clean
rm -rf out
rm -rf malware_samples
